licodo.classify=function(){var o,l,i,s,a,c,d={main_html:String()+'<div class = "licodo-classify-head">所有任务</div><ul class = "licodo-classify-main"></ul><div class = "licodo-classify-add"><span class = "licodo-task-add">＋</span><span class = "licodo-classify-newTitle">新建分类</span> </div>'},e={overMode:null,overBool:!1,classifyMain:null,target:null,infoStr:null},t={};return l=function(){t={$overlay:$(".licodo-shell-overlay")[0]||"",$add:$(".licodo-classify-add")[0]||"",$classifyMain:$(".licodo-classify-main")[0]||"",$classifyItem:$(".licodo-classify-item")||""}},a=function(){var o,l,i,s,a,d=licodo.data.getStorage("cate"),e=licodo.data.getStorage("childCate");if(hasClass($(".licodo-classify-main")[0],"licodo-classify-on"))l={id:d[d.length-1].id+1,name:licodo.util.filterXSS($(".licodo-overlay-input")[0].value),child:[],taskChild:[]},d.push(l),licodo.data.saveStorage(d);else{s=$(".licodo-classify-on")[0].parentNode.id,o="#"+s,a=0!=e.length?e[e.length-1].id+1:0,i={id:a,key:e.length,name:$(".licodo-overlay-input")[0].value,parent:parseInt(s.substring(20,s.length)),taskChild:[]};var t=licodo.util.getObjByKey(d,"id",i.parent);t.child.push(i.id),licodo.data.saveStorage(d),e.push(i),licodo.data.saveStorage(e)}c(),licodo.classify.setSelectorMap()},c=function(){for(var o,l=licodo.data.getStorage("cate"),i=licodo.data.getStorage("childCate"),s="",a=0;a<l.length;a++){if(s+='<li class = "licodo-classify-item" id = "licodo-classify-item'+l[a].id+'"><span class = "licodo-classify-itemName">'+l[a].name+" ("+l[a].taskChild.length+')</span><span class = "licodo-classify-itemDel"></span>',0!==l[a].child.length){s+='<ul class = "licodo-classify-subMain">';for(var c=0;c<l[a].child.length;c++)o=licodo.util.getObjByKey(i,"id",l[a].child[c]),o&&(s+='<li class = "licodo-classify-subItem" id = "licodo-classify-subItem'+o.id+'"><span class = "licodo-classify-itemName">'+o.name+" ("+o.taskChild.length+')</span><span class = "licodo-classify-itemDel licodo-classify-subItemDel"></span></li>');s+="</ul>"}s+="</li>"}$(".licodo-classify-main")[0].innerHTML=s,$("#licodo-classify-item0")[0].childNodes[1].style.display="none",addClass($("#licodo-classify-item0")[0].childNodes[0],"licodo-classify-on"),hasClass($(".licodo-classify-main")[0],"licodo-classify-on")&&removeClass($(".licodo-classify-main")[0],"licodo-classify-on")},i=function(){hasClass($("#licodo-classify-item0")[0],"licodo-classify-on")||hasClass($("#licodo-classify-item0")[0].childNodes[0],"licodo-classify-on")?(e.infoStr="默认任务不能添加子分类",licodo.info.configModule({infoStr:e.infoStr})):0==$(".licodo-classify-on")[0].parentNode.className.indexOf("licodo-classify-subItem")?(e.infoStr="子分类不能添加子分类",licodo.info.configModule({infoStr:e.infoStr})):(e.overMode=1,e.overBool=!0,licodo.overlay.configModule({overMode:e.overMode,overBool:e.overBool}))},s=function(){var o=arguments[0]||window.event,l=o.srcElement?o.srcElement:o.target;hasClass(l,"licodo-classify-main")?licodo.util.addClassOn(l,"licodo-classify-on"):hasClass(l,"licodo-classify-itemDel")?(e.overMode=2,e.overBool=!0,e.target=l,licodo.overlay.configModule({overMode:e.overMode,overBool:e.overBool,target:e.target})):(licodo.util.addClassOn(l,"licodo-classify-on"),licodo.task.makeTask(l),licodo.util.addClassOn($("#licodo-task-all")[0],"licodo-task-processOn"),$("#licodo-task-ul0")[0]?(addClass($("#licodo-task-ul0")[0].childNodes[0],"licodo-task-on"),licodo.text.makeText($("#licodo-task-ul0")[0].childNodes[0])):licodo.text.makeText()),licodo.util.mobileFit()&&(hasClass(l,"licodo-classify-main")||hasClass(l,"licodo-classify-itemDel")||licodo.shell.showPage($(".licodo-mobile-task")[0]))},o=function(o){o.innerHTML=d.main_html,l(),c(),licodo.overlay.initModule(t.$overlay),addClickEvent(t.$add,i),addClickEvent(t.$classifyMain,s),$.on(t.$classifyMain,"touchstart",s)},{initModule:o,setSelectorMap:l,addItems:a,makeItems:c}}();